<!DOCTYPE html>
<html lang="en-US" data-theme="light">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>An uninformed perspective on TaihuLight's design - hpc.social - Aggregated Personal Blog</title>
        <meta name="description" content="Shared personal experiences and stories">
        <meta name="keywords" content="">
        <base href="https://hpc.social/personal-blog" />
        
        <meta content="2016-06-21T07:36:00-06:00" property="article:published_time">
        <meta content="https://hpc.social/about/" property="article:author">
          
        <meta property="og:site_name" content="hpc.social - Aggregated Personal Blog">
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://hpc.social/personal-blog/2016/an-uninformed-perspective-on-taihulight-s-design/"/>
        <meta property="og:title" content="An uninformed perspective on TaihuLight's design - hpc.social - Aggregated Personal Blog" />
        <meta property="og:description" content="Shared personal experiences and stories" />
        <meta property="og:image" content="https://hpc.social/personal-blog/assets/images/hpc-social-blue.png"/>
        <meta name="twitter:site" content="@hpc_social" />
        <meta name="twitter:creator" content="@hpc_social" /> 
        <meta name="twitter:card" content="summary"/>
        <meta property="twitter:title" content="An uninformed perspective on TaihuLight's design - hpc.social - Aggregated Personal Blog" />
        <meta property="twitter:description" content="Shared personal experiences and stories" />
        <meta property="twitter:image" content="https://hpc.social/personal-blog/assets/images/hpc-social-blue.png" />
        <link rel="stylesheet" href="/personal-blog/assets/css/highlight.css">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Catamaran:wght@300&display=swap" rel="stylesheet"> 

        <link rel="stylesheet" href="/personal-blog/assets/css/style.css">
        <link rel="shortcut icon" href="/personal-blog/assets/images/hpc-social-blue.png" />
        <link rel="alternate" type="application/atom+xml" title="hpc.social - Aggregated Personal Blog" href="https://hpc.social/personal-blog/atom.xml">
        <link rel="alternate" type="application/json" title="hpc.social - Aggregated Personal Blog" href="https://hpc.social/personal-blog/feed.json" />
        <link rel="sitemap" type="application/xml" title="sitemap" href="https://hpc.social/personal-blog/sitemap.xml" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","author":{"@type":"Person","name":"hpc.social"},"description":"Shared personal experiences and stories","headline":"hpc.social - Aggregated Personal Blog","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://hpc.social/personal-blog/assets/images/hpc-social-blue.png"},"name":"hpc.social"},"sameAs":["https://twitter.com/","https://github.com/"],"url":"https://hpc.social/personal-blog"}</script>
    </head>
<body>

<div class="container">
	<div class="profile">
		<a href="https://hpc.social/personal-blog/"><img src="/personal-blog/assets/images/hpc-social-blue.png" class="profile-image"></a>
		<div class="profile-about">
			<h2 style="margin-bottom: 0; font-weight: 700;">hpc.social</h2>
			
			
				<a href="https://twitter.com/hpc_social" target="_blank"><img src="/personal-blog/assets/images/icon/twitter.svg" class="social-icon"></a>
			
			
			
			
				<a href="https://github.com/hpc-social" target="_blank"><img src="/personal-blog/assets/images/icon/github.svg" class="social-icon"></a>
			
			
			<a href="/personal-blog/about/"><img src="/personal-blog/assets/images/icon/me.svg" class="social-icon"></a>
			<br>
			High Performance Computing <br> Practitioners <br> and friends /#hpc
			<br>
			<div class="mode" id="mode-switcher" onclick="toggleNightMode();">
				<span></span>
			</div>
		</div>
	</div>
	
<div class="post-header">
	<div class="post-date">21.06.2016  &middot; <span class="reading-time" title="Estimated read time">
  
   12 mins  read </span>
</div>
	<div class="post-share">
		Share:&nbsp; 
		<a href="https://twitter.com/intent/tweet?source=tweetbutton&amp;original_referer=https://hpc.social/an-uninformed-perspective-on-taihulight-s-design&amp;text=An uninformed perspective on TaihuLight's design - https://hpc.social/an-uninformed-perspective-on-taihulight-s-design" target="_blank"><img src="https://hpc.social/personal-blog/assets/images/icon/twitter.svg" class="social-icon"></a>
	</div>
</div>

<div class="tags-container" style="padding:10px; font-size:18px; font-style:italic">
        This is a crosspost from &nbsp; <a target="_blank" href="https://glennklockwood.blogspot.com/search/label/hpc">Glenn K. Lockwood</a>&nbsp;Personal thoughts and opinions of a supercomputing enthusiast.&nbsp;See the original post&nbsp;<a target="_blank" href="https://glennklockwood.blogspot.com/2016/06/an-uninformed-perspective-on.html">here</a>.</div>

<div class="blog-post-content">
	<h1>An uninformed perspective on TaihuLight's design</h1>
	<div style="line-height: 100%; text-align: center;"><span style="font-size: xx-small;">Note: What follows are my own personal thoughts, opinions, and analyses. &nbsp;I am not a computer scientist and I don't really know anything about processor design or application performance, so it is safe to assume I don't know what I'm talking about. &nbsp;None of this represents the views of my employer, the U.S. government, or anyone except me.</span></div>
<p><br /><a href="http://top500.org/news/china-tops-supercomputer-rankings-with-new-93-petaflop-machine/">China’s new 93 PF TaihuLight system</a> is impressive given the indigenous processor design and its substantial increase in its HPL score over the #2 system, Tianhe-2.  The <a href="http://www.nytimes.com/2016/06/21/technology/china-tops-list-of-fastest-computers-again.html?_r=0">popular media has started covering this new system and the increasing presence of Chinese systems on Top500</a>, suggesting that China’s string of #1 systems may be a sign of shifting tides.  And maybe it is.  China is undeniably committed to investing in supercomputing and positioning itself as a leader in extreme-scale computing.<br /><br />That being said, the TaihuLight system isn’t quite the technological marvel and threat to the HPC hegemony that it may seem at first glance.  The system features some some critically limiting design choices that make the system smell like a supercomputer that was <a href="http://www.scmp.com/tech/science-research/article/1773421/chinese-supercomputer-too-slow-compete-race-hypersonic-weapons">designed to be #1 on Top500</a>, not solve scientific problems.  This probably sounds like sour grapes at this point, so let’s take a look at some of the details.<br /><br />&lt;h2&gt;Back-of-the-envelope math&lt;/h2&gt;Consider the fact that each TaihuLight node turns 3,062 GFLOPS (that’s 3 TFLOPS) and has 136.51 GB/sec of memory bandwidth. This means that in the time it takes for the processor to load two 64-bit floats into the processor from memory, it could theoretically perform over 350 floating point operations. But it won’t, because it can only load the two operands for one single FLOP.<br /><br />Of course, this is an oversimplification of how CPUs work.  Caches exist to feed the extremely high operation rate of modern processors, and where there are so many cores that their caches can’t be fed fast enough, we see technologies like GDDR DRAM and <a href="http://www.extremetech.com/gaming/179159-gtc-2014-nvidia-reveals-dual-gpu-titan-z-new-pascal-gpu-offers-colossal-memory-bandwidth">HBM</a> (on accelerators) and on-package <a href="https://software.intel.com/en-us/blogs/2016/01/20/an-intro-to-mcdram-high-bandwidth-memory-on-knights-landing">MCDRAM</a> (on KNL) appearing so that dozens or hundreds of cores can all retrieve enough floating-point operands from memory to sustain high rates of floating point calculations.<br /><br />However, the ShenWei SW26010 chips in the TaihuLight machine have neither GDDR nor MCDRAM; they rely on four DDR3 controllers running at 136 GB/sec to keep all 256 compute elements fed with data.  <a href="http://www.netlib.org/utk/people/JackDongarra/PAPERS/sunway-report-2016.pdf">Dongarra’s report on the TaihuLight design</a> briefly mentions this high skew:<br /><br />&lt;blockquote class="tr_bq"&gt;“The ratio of floating point operations per byte of data from memory on the SW26010 is 22.4 Flops(DP)/Byte transfer, which shows an imbalance or an overcapacity of floating point operations per data transfer from memory. By comparison the Intel Knights Landing processor with 7.2 Flops(DP)/Byte transfer.”&lt;/blockquote&gt;<br />This measure of “Flops(DP)/Byte transfer” is called arithmetic intensity, and it is a critical optimization parameter when writing applications for manycore architectures.  Highly optimized GPU codes can show <a href="http://people.eecs.berkeley.edu/~kubitron/cs258/lectures/lec12-Merrimac.pdf">arithmetic intensities of around 10 FLOPS/byte</a>, but such applications are often the exception; there are classes of problems that simply do not have high arithmetic intensities.  This diagram, which I stole from the <a href="https://crd.lbl.gov/departments/computer-science/PAR/research/roofline/">Performance and Algorithms Research group at Berkeley Lab</a>, illustrates the spectrum:<br /><br />&lt;div class="separator" style="clear: both; text-align: center;"&gt;<a href="https://3.bp.blogspot.com/-E_1Yi-g0qws/V2jCeZo0dUI/AAAAAAAATSA/2WCXZkchvuUclAXdyIUhv2ODQI7bv4AuwCLcB/s1600/ResizedImage600300-rooflineai.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="200" src="https://3.bp.blogspot.com/-E_1Yi-g0qws/V2jCeZo0dUI/AAAAAAAATSA/2WCXZkchvuUclAXdyIUhv2ODQI7bv4AuwCLcB/s400/ResizedImage600300-rooflineai.png" width="400" /></a>&lt;/div&gt;
<br />To put this into perspective in the context of hardware, let’s look at the #3 supercomputer, <a href="https://www.olcf.ornl.gov/titan/">the Titan system at Oak Ridge National Lab</a>.  The GPUs on which it is built (<a href="http://www.nvidia.com/content/tesla/pdf/nvidia-tesla-kepler-family-datasheet.pdf">NVIDIA’s K20X</a>) each have a GDDR5-based memory subsystem that can feed the 1.3 TFLOP GPUs at 250 GB/sec.  This means that Titan’s FLOPS/byte ratio is around 5.3, or over 4x lower (more balanced) than the 22 FLOPS/byte of TaihuLight’s SW26010 chips.<br /><br />This huge gap means that an application that is perfectly balanced to run on a Titan GPU–that is, an application with an arithmetic intensity of 5.3–will run 4x slower on one of TaihuLight’s SW26010 processors than a Titan GPU.  Put simply, despite being theoretically capable of doing 3 TFLOPS of computing, TaihuLight’s processors would only be able to deliver performance to 1/4th of that, or 0.75 TFLOPS, to this application.  Because of the severely limited per-node memory bandwidth, <b>this 93 PFLOP system would perform like a 23 PFLOP system</b> on an application that, given an arithmetic intensity of 5.3, would be considered highly optimized by most standards.<br /><br />Of course, the indigenous architecture also means that application developers will have to rely on indigenous implementations or ports of performance runtimes like OpenMP and OpenACC, libraries like BLAS, and ISA-specific vector intrinsics.  The maturity of this software stack for the ShenWei-64 architecture remains unknown.<br /><br />&lt;h2&gt;What <i>is</i> interesting&lt;/h2&gt;This all isn’t to say that the TaihuLight system isn’t a notable achievement; it is the first massive-scale deployment of a CPU-based manycore processor, it is the first massive-scale deployment of EDR InfiniBand, and its CPU design is extremely interesting in a number of ways.<br /><br />The CPU block diagrams included in Dongarra’s report are a bit like a Rorschach test; my esteemed colleagues at <a href="http://www.nextplatform.com/2016/06/20/look-inside-chinas-chart-topping-new-supercomputer/">The Next Platform astutely pointed out its similarities to KNL</a>, but my first reaction was to compare it with IBM’s Cell processor:<br /><br />&lt;table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td style="text-align: center;"&gt;<a href="https://2.bp.blogspot.com/-rCGxhO2fVGw/V2jMRV379wI/AAAAAAAATSQ/l20liolD4jcU8ZxZbkejw5asAeZIOKvZQCLcB/s1600/Cell%2BBE%2Bvs%2BShenWei%2BSW26010.png" style="margin-left: auto; margin-right: auto;"><img border="0" height="181" src="https://2.bp.blogspot.com/-rCGxhO2fVGw/V2jMRV379wI/AAAAAAAATSQ/l20liolD4jcU8ZxZbkejw5asAeZIOKvZQCLcB/s400/Cell%2BBE%2Bvs%2BShenWei%2BSW26010.png" width="400" /></a>&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="tr-caption" style="text-align: center;"&gt;IBM Cell BE vs. ShenWei SW26010.  <a href="http://www.hec.nasa.gov/news/features/2008/cell.074208.html">Cell diagram stolen from NAS</a>; <a href="http://www.netlib.org/utk/people/JackDongarra/PAPERS/sunway-report-2016.pdf">SW26010 diagram stolen from the Dongarra report</a>.&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;<br />The Cell processor was ahead of its time in many ways and arguably the first manycore chip targeted at HPC.  It had<br />&lt;ul&gt;&lt;li&gt;a single controller core (the PPE) with L1 and L2 caches&lt;/li&gt;&lt;li&gt;eight simpler cores (the SPEs) on an on-chip network with no L2 cache, but an embedded SRAM scratchpad&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;and by comparison, the SW26010 has&lt;/div&gt;</p>
<div><ul><li>a single controller core (the MPE) with L1 and L2 caches</li><li>sixty-four simpler cores (the CPEs) on an on-chip network with no L2 cache, but an embedded SRAM scratchpad</li></ul></div>
<p>Of course, the similarities are largely superficial and there are vast differences between the two architectures, but the incorporation of heterogeneous (albeit very similar) cores on a single package is quite bold and is a design point that may play a role in exascale processor designs:<br /><br />&lt;table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td style="text-align: center;"&gt;<a href="https://3.bp.blogspot.com/--seFJF-UhLw/V2jPfRKPXoI/AAAAAAAATSc/MXVgxyovM4YF0xo9k4XMlpbWY0TUJi80QCLcB/s1600/CQP3qklUsAAjcNT.png" style="margin-left: auto; margin-right: auto;"><img border="0" height="300" src="https://3.bp.blogspot.com/--seFJF-UhLw/V2jPfRKPXoI/AAAAAAAATSc/MXVgxyovM4YF0xo9k4XMlpbWY0TUJi80QCLcB/s400/CQP3qklUsAAjcNT.png" width="400" /></a>&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="tr-caption" style="text-align: center;"&gt;What an exascale processor might look like, as <a href="https://twitter.com/hpc_guru/status/649645068995792896">stolen from Kathy Yelick</a>&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;<br />which may feature a combination of many lightweight cores (not unlike the CPE arrays on the TaihuLight processor) and are accompanied by a few capable cores (not unlike the MPE cores).<br /><br />The scratchpad SRAM present on all of the CPE cores is also quite intriguing, as it is a marked departure from the cache-oriented design of on-package SRAM that has dominated CPU architectures for decades.  The Dongarra report doesn’t detail how the scratchpad SRAM is used by applications, but it may offer a unique new way to perform byte-granular loads and stores that do not necessarily waste a full cache line’s worth of memory bandwidth if the application knows that memory access is to be unaligned.<br /><br />This is a rather forward-looking design decision that makes the CPU look a little more like a GPU.  Some experimental processor designs targeting exascale have proposed eschewing deep cache hierarchies in favor of similar scratchpads:<br /><br />&lt;table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td style="text-align: center;"&gt;<a href="https://3.bp.blogspot.com/-swXDcTMnt4Q/V2jTH1YUpBI/AAAAAAAATSo/NDvIZdI53NMNIsP6ATzeIevJX4yPIQCBACLcB/s1600/Traleika%2BGlacier%2Bblock.png" style="margin-left: auto; margin-right: auto;"><img border="0" height="187" src="https://3.bp.blogspot.com/-swXDcTMnt4Q/V2jTH1YUpBI/AAAAAAAATSo/NDvIZdI53NMNIsP6ATzeIevJX4yPIQCBACLcB/s400/Traleika%2BGlacier%2Bblock.png" width="400" /></a>&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="tr-caption" style="text-align: center;"&gt;The Traleika Glacier processor design, featuring separate control and execution blocks and scratchpad SRAM.  Adapted from the <a href="https://xstackwiki.modelado.org/Traleika_Glacier#Architecture">Traleika Glacier wiki page</a>.&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;<br />Whether or not we ever hear about how successful or unsuccessful these processor features are remains to be seen, but there may be valuable lessons to be learned ahead of the first generation of exascale processors from architectures like those in the TaihuLight system.<br /><br />&lt;h2&gt;Outlook&lt;/h2&gt;At a glance, it is easy to call out the irony in the U.S. government’s decision to ban the sale of Intel’s KNL processors to the Chinese now that the TaihuLight system is public.  It is clear that China is in a position to begin building extreme-scale supercomputers without the help of Intel, and it is very likely that the U.S. embargo accelerated this effort.  As pondered by an notable pundit in the HPC community,<br /><br />&lt;blockquote class="twitter-tweet"&gt;&lt;div dir="ltr" lang="en"&gt;If US gov hadn’t barred US <a href="https://twitter.com/hashtag/HPC?src=hash">#HPC</a> tech to China, new No.1 <a href="https://twitter.com/hashtag/supercomputer?src=hash">#supercomputer</a> could’ve been <a href="https://twitter.com/hashtag/KNL?src=hash">#KNL</a>-powered instead of Chinese CPUs? <a href="https://twitter.com/hashtag/ISC16?src=hash">#ISC16</a> <a href="https://twitter.com/hashtag/backfired?src=hash">#backfired</a>&lt;/div&gt;
— Andrew Jones (@hpcnotes) <a href="https://twitter.com/hpcnotes/status/744976851567779841">June 20, 2016</a>&lt;/blockquote&gt; <br />And this may have been the case.  However, despite the TaihuLight system’s #1 position and very noteworthy Linpack performance and efficiency, is not the massive disruptor that puts the U.S. in the back seat.  Underneath TaihuLight’s shiny, 93-petaflop veneer are some cut corners that substantially lower its ability to reliably deliver the performance and scientific impact commensurate to its Linpack score.  As <a href="https://twitter.com/hpcprogrammer/status/744982095127248901">pointed out by a colleague wiser than me</a>, Intel’s impending KNL chip is the product of years of effort, and it is likely that it will be years before ShenWei’s chip designs and fabs are able to be really deliver a fully balanced, competitive, HPC-oriented microarchitecture.<br /><br />With that being said, TaihuLight is still a massive system, and even if its peak Linpack score is not representative of its actual achievable performance in solving real scientific problems, it is undeniably a leadership system.  Even if applications can only realize a small fraction of its Linpack performance, there is a lot of discovery to be made in petascale computing.<br /><br />Further, the SW201060 processor itself features some bold design points, and being able to test a heterogeneous processor with scratchpad SRAM at extreme scale may give China a leg up in the exascale architecture design space.  Only time will tell if these opportunities are pursued, or if TaihuLight follows its predecessors into an existence of disuse in a <a href="http://www.marketwatch.com/story/chinas-bevy-of-supercomputers-goes-unused-2014-07-15">moldy datacenter</a> caused by a <a href="http://www.scmp.com/news/china/article/1543226/chinas-world-beating-supercomputer-fails-impress-some-potential-clients">high electric bill</a>, <a href="http://www.scmp.com/tech/science-research/article/1773421/chinese-supercomputer-too-slow-compete-race-hypersonic-weapons">poor system design, and lack of software</a>.</p>

</div>
<div class="tags-container">
	
</div>
<style>
#uppy {
  position: fixed;
  bottom: 50px;
  right: 50px;
  z-index: 99;
  border: none;
  outline: none;
  background-color: darkturquoise;
  color: black;
  cursor: pointer;
  margin:15px;
  border-radius: 10px;
  width: 100px;
  height: 20px;
}

#returnTop:hover {
  background-color: #555;
}
</style>

<button id="uppy" title="Return to Top" class="btn btn-lg">Back to top</button>

<script>
(function() {

var scrollTop = function() {
    window.scrollTo(0, 0);
};

document.getElementById('uppy').onclick = scrollTop;

})();
</script>


<div class="navigation">
	
		<a class="prev" href="/personal-blog/2016/spark-chapel-tensorflow-workshop-at-umich/">< Spark, Chapel, TensorFlow- Workshop at UMich</a>
	 
	<a class="next" href="/personal-blog/2016/basics-of-i-o-benchmarking/">Basics of I/O Benchmarking ></a>

</div>

	<div class="footer">
		<span style="padding-right:10px"><font color="red">©️ </font><a href="https://hpc.social"><b>hpc.social</b> community</a></span> 
		| <a style="padding-left:10px; padding-right:10px" href="/personal-blog/archive/">Archive</a>
		| <a style="padding-left:10px; padding-right:10px" href="/personal-blog/">Posts</a>
		| <a style="padding-left:10px; padding-right:10px" href="/personal-blog/about/">About</a>
		| <a style="padding-left:10px; padding-right:10px" href="https://hpc.social/blog">hpc.social blogs</a>
		| <a style="padding-left:37%;" target="_blank" href="https://github.com/hpc-social/personal-blog">Add Your Blog</a>
	</div>
</div>
    <script src="/personal-blog/assets/scripts.js"></script>
    <script type="text/javascript">
        if (localStorage.theme === 'light') {
            document.documentElement.setAttribute('data-theme', 'light');
            document.getElementById('mode-switcher').classList.add('active');
        } else if (localStorage.theme === 'dark' || localStorage.theme === '' || (!('theme' in localStorage))) {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('mode-switcher').classList.add('active');
        }
    </script>
</body>
</html>

